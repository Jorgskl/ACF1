<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC F1 | Championship Standings</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="main-header">
        <nav class="navbar">
            <a href="index.html" class="nav-logo">ACF1</a>
            <ul class="nav-menu">
                  <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="results.html" class="nav-link">Results</a></li>
                <li class="nav-item"><a href="rankings.html" class="nav-link">Power Rankings</a></li>
                <li class="nav-item"><a href="standings.html" class="nav-link active">Standings</a></li>
                <li class="nav-item"><a href="news.html" class="nav-link">News</a></li>
            </ul>
        </nav>
    </header>

    <main class="rankings-main">
        <div class="rankings-container">

            <div class="event-selector-container">
                <button id="show-drivers-btn" class="event-tab active">Drivers</button>
                <button id="show-teams-btn" class="event-tab">Teams</button>
            </div>

            <!-- DRIVER STANDINGS VIEW -->
            <div id="driver-standings-view">
                <div class="rankings-header">
                    <h1>Driver Standings</h1>
                    <p>Official championship standings based on points accumulated in race events.</p>
                </div>
                <div id="driver-standings-list" class="standings-list-visual"></div>
            </div>

            <!-- TEAM STANDINGS VIEW -->
            <div id="team-standings-view" style="display: none;">
                <div class="rankings-header">
                    <h1>Constructor Standings</h1>
                    <p>Official constructor championship standings, calculated by summing the points of each team's drivers.</p>
                </div>
                <div id="team-standings-list" class="standings-list-visual"></div>
            </div>

        </div>
    </main>
    
    <!-- NOVOS TEMPLATES VISUAIS -->
    <template id="driver-standing-item-template">
        <div class="standing-item" data-team-container>
            <div class="standing-pos">
                <span class="pos-rank" data-rank></span>
                <span class="pos-gap" data-gap></span>
            </div>
            <div class="standing-driver">
                <span class="driver-name" data-name></span>
                <span class="team-name" data-team-name></span>
            </div>
            <div class="standing-points">
                <span data-points></span> PTS
            </div>
        </div>
    </template>

    <template id="team-standing-item-template">
         <div class="standing-item" data-team-container>
            <div class="standing-pos">
                <span class="pos-rank" data-rank></span>
                 <span class="pos-gap" data-gap></span>
            </div>
            <div class="standing-driver">
                <img src="" alt="" class="team-logo-standings" data-img>
                <span class="driver-name" data-name></span>
            </div>
            <div class="standing-points">
                <span data-points></span> PTS
            </div>
        </div>
    </template>
    
    <!-- JAVASCRIPT ATUALIZADO -->
    <script src="database.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setupTabs();
            
            const driverStandings = calculateDriverStandings(tournamentData);
            const teamStandings = calculateTeamStandings(driverStandings, tournamentData);

            renderDriverStandings(driverStandings, tournamentData);
            renderTeamStandings(teamStandings, tournamentData);
        });

        function setupTabs() {
            const showDriversBtn = document.getElementById('show-drivers-btn');
            const showTeamsBtn = document.getElementById('show-teams-btn');
            const driverView = document.getElementById('driver-standings-view');
            const teamView = document.getElementById('team-standings-view');

            showDriversBtn.addEventListener('click', () => {
                driverView.style.display = 'block';
                teamView.style.display = 'none';
                showDriversBtn.classList.add('active');
                showTeamsBtn.classList.remove('active');
            });

            showTeamsBtn.addEventListener('click', () => {
                driverView.style.display = 'none';
                teamView.style.display = 'block';
                showTeamsBtn.classList.add('active');
                showDriversBtn.classList.remove('active');
            });
        }

        function calculateDriverStandings(db) {
            const standings = {};
            Object.keys(db.drivers).forEach(driverId => {
                standings[driverId] = { id: driverId, points: 0 };
            });

            db.allEvents.forEach(event => {
                if (event.eventType === 'race') {
                    const raceSession = event.sessions.find(s => s.type === 'race');
                    if (raceSession && raceSession.results) {
                        raceSession.results.forEach(result => {
                            if (standings[result.driverId] && result.points) {
                                standings[result.driverId].points += result.points;
                            }
                        });
                    }
                }
            });

            const sortedStandings = Object.values(standings).sort((a, b) => b.points - a.points);

            if (sortedStandings.length > 0) {
                const leaderPoints = sortedStandings[0].points;
                sortedStandings.forEach(driver => {
                    driver.gap = leaderPoints - driver.points;
                });
            }
            return sortedStandings;
        }

        function calculateTeamStandings(driverStandings, db) {
            const teamStandings = {};
            Object.keys(db.teams).forEach(teamId => {
                teamStandings[teamId] = { id: teamId, points: 0 };
            });

            driverStandings.forEach(driverResult => {
                const driverInfo = db.drivers[driverResult.id];
                if (driverInfo && teamStandings[driverInfo.teamId]) {
                    teamStandings[driverInfo.teamId].points += driverResult.points;
                }
            });

            const sortedStandings = Object.values(teamStandings).sort((a, b) => b.points - a.points);
            
            if (sortedStandings.length > 0) {
                const leaderPoints = sortedStandings[0].points;
                sortedStandings.forEach(team => {
                    team.gap = leaderPoints - team.points;
                });
            }
            return sortedStandings;
        }

        function renderDriverStandings(standings, db) {
            const template = document.getElementById('driver-standing-item-template');
            const container = document.getElementById('driver-standings-list');
            container.innerHTML = '';

            standings.forEach((driverData, index) => {
                const driver = db.drivers[driverData.id];
                const team = db.teams[driver.teamId];
                const clone = template.content.cloneNode(true);
                const mainEl = clone.querySelector('.standing-item');

                mainEl.classList.add(team.className);
                if (index === 0) {
                    mainEl.classList.add('leader');
                }

                clone.querySelector('[data-rank]').textContent = index + 1;
                clone.querySelector('[data-gap]').textContent = index === 0 ? 'LEADER' : `-${driverData.gap}`;
                clone.querySelector('[data-name]').textContent = driver.name.toUpperCase();
                clone.querySelector('[data-team-name]').textContent = team.name;
                clone.querySelector('[data-points]').textContent = driverData.points;
                
                container.appendChild(clone);
            });
        }

        function renderTeamStandings(standings, db) {
            const template = document.getElementById('team-standing-item-template');
            const container = document.getElementById('team-standings-list');
            container.innerHTML = '';

            standings.forEach((teamData, index) => {
                const team = db.teams[teamData.id];
                const clone = template.content.cloneNode(true);
                const mainEl = clone.querySelector('.standing-item');

                mainEl.classList.add(team.className);
                if (index === 0) {
                   mainEl.classList.add('leader');
                }

                clone.querySelector('[data-rank]').textContent = index + 1;
                clone.querySelector('[data-gap]').textContent = index === 0 ? 'LEADER' : `-${teamData.gap}`;
                clone.querySelector('[data-img]').src = team.logoUrl;
                clone.querySelector('[data-name]').textContent = team.name.toUpperCase();
                clone.querySelector('[data-points]').textContent = teamData.points;
                
                container.appendChild(clone);
            });
        }
    </script>
</body>
</html>